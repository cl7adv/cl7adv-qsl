<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Buscador QSL - Radio Club Santa Cruz del Sur</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
        :root {
            --neon: #00ff99;
            --gold: #ffe082;
            --glass: rgba(0, 15, 25, 0.82);
        }

        body { 
            margin: 0; 
            font-family: 'Segoe UI', Tahoma, sans-serif; 
            /* CARGA DE TU IMAGEN fondo.jpg */
            background-image: url('fondo.jpg'); 
            background-size: cover;
            background-position: center center;
            background-attachment: fixed;
            /* Esto ayuda a que el buscador resalte sobre la playa */
            background-color: rgba(0, 0, 0, 0.3);
            background-blend-mode: darken;
            
            display: flex; 
            align-items: center; 
            justify-content: center; 
            min-height: 100vh;
            color: #fff;
        }

        .container { 
            max-width: 550px; width: 85%; padding: 40px; 
            background: var(--glass); 
            border-radius: 25px; 
            border: 2px solid var(--neon);
            box-shadow: 0 0 30px rgba(0, 255, 153, 0.3);
            text-align: center;
            backdrop-filter: blur(10px); /* Efecto cristal empa√±ado */
        }

        h1 { font-size: 2rem; margin-bottom: 5px; text-shadow: 0 0 10px var(--neon); }
        .subtitle { color: var(--gold); margin-bottom: 30px; font-size: 0.85rem; letter-spacing: 2px; text-transform: uppercase; }

        .search-box { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; }

        #indicativo { 
            padding: 15px; font-size: 1.3rem; border: 2px solid rgba(0, 255, 153, 0.4); 
            border-radius: 12px; width: 220px; background: rgba(0,0,0,0.7);
            color: var(--neon); font-weight: bold; text-transform: uppercase;
            text-align: center; outline: none;
        }

        #buscarBtn { 
            padding: 15px 30px; font-size: 1rem; 
            background: linear-gradient(145deg, #ff9800, #f57c00); 
            color: #fff; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; 
            box-shadow: 0 4px 0 #b35900; transition: 0.1s;
        }

        #buscarBtn:active { transform: translateY(3px); box-shadow: 0 1px 0 #b35900; }

        /* Barra de Carga */
        .progress-wrap {
            width: 100%; height: 8px; background: rgba(255,255,255,0.1); 
            border-radius: 10px; margin: 50px auto 20px; position: relative; display: none;
        }
        .progress-bar { height: 100%; background: var(--neon); width: 0%; border-radius: 10px; box-shadow: 0 0 10px var(--neon); }
        .card-icon {
            position: absolute; top: -35px; left: 0%; transform: translateX(-50%);
            width: 45px; height: 30px; background: white; border-radius: 5px;
            display: flex; align-items: center; justify-content: center; border: 2px solid var(--gold);
        }

        .status { height: 25px; color: var(--neon); font-size: 0.9rem; margin-top: 10px; font-weight: bold; }

        /* Modal de Im√°genes */
        .modal { display: none; position: fixed; z-index: 999; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); overflow-y: auto; padding: 20px; }
        .modal-content { background: var(--glass); max-width: 800px; margin: 40px auto; padding: 30px; border-radius: 20px; border: 1px solid var(--neon); text-align: center; }
        .qsl-card { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px; margin-bottom: 20px; }
        .qsl-card img { width: 100%; border-radius: 8px; }
        .dl-link { display: inline-block; margin-top: 10px; padding: 10px 20px; background: #28a745; color: white; text-decoration: none; border-radius: 8px; font-weight: bold; }

        footer { margin-top: 30px; font-size: 0.75rem; opacity: 0.6; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px; }
    </style>
</head>
<body>

    <div class="container">
        <h1>üå¥ QSL CARIBE√ëA</h1>
        <div class="subtitle">Radio Club Santa Cruz del Sur <br> ZMR CUBA</div>

        <div class="search-box">
            <input type="text" id="indicativo" placeholder="CALLSIGN" maxlength="10">
            <button id="buscarBtn" onclick="iniciarBusqueda()">BUSCAR</button>
        </div>

        <div id="pWrap" class="progress-wrap">
            <div id="pCard" class="card-icon">‚úâÔ∏è</div>
            <div id="pBar" class="progress-bar"></div>
        </div>

        <div id="status" class="status"></div>
        <div id="errorArea"></div>

        <footer>
            CL7ADV &bull; Alfred &bull; 2026<br>
            73's Cordiales para la Radioafici√≥n Cubana
        </footer>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle" style="color:var(--gold)"></h2>
            <div id="qslGrid" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap:20px;"></div>
            <button onclick="cerrarModal()" style="margin-top:30px; padding:10px 30px; cursor:pointer; background:#555; border:none; color:white; border-radius:8px;">CERRAR</button>
        </div>
    </div>

    <script>
        function playStatic() {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const buf = ctx.createBuffer(1, ctx.sampleRate * 1.2, ctx.sampleRate);
                const out = buf.getChannelData(0);
                for (let i = 0; i < buf.length; i++) out[i] = Math.random() * 2 - 1;
                const src = ctx.createBufferSource();
                src.buffer = buf;
                const gain = ctx.createGain();
                gain.gain.setValueAtTime(0.03, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 1.2);
                src.connect(gain); gain.connect(ctx.destination);
                src.start();
            } catch(e) {}
        }

        async function iniciarBusqueda() {
            const call = document.getElementById('indicativo').value.trim().toUpperCase();
            if(!call) return;

            playStatic();
            document.getElementById('errorArea').innerHTML = "";
            const pWrap = document.getElementById('pWrap');
            const pBar = document.getElementById('pBar');
            const pCard = document.getElementById('pCard');
            const status = document.getElementById('status');

            pWrap.style.display = "block";
            
            let p = 0;
            const t = setInterval(async () => {
                p += 4;
                pBar.style.width = p + "%";
                pCard.style.left = p + "%";
                if(p == 40) status.innerText = "SINTONIZANDO SE√ëAL...";
                if(p == 80) status.innerText = "VERIFICANDO LOGS...";
                if(p >= 100) {
                    clearInterval(t);
                    buscarFotos(call);
                }
            }, 50);
        }

        async function buscarFotos(call) {
            const exts = ['jpg', 'JPG', 'png', 'PNG', 'jpeg'];
            let encontradas = [];
            let rutas = [];

            exts.forEach(e => {
                rutas.push(`img/${call}.${e}`);
                for(let i=1; i<=5; i++) rutas.push(`img/${call}-${i}.${e}`);
            });

            const promesas = rutas.map(r => {
                return new Promise(res => {
                    const i = new Image();
                    i.onload = () => { encontradas.push(r); res(); };
                    i.onerror = () => res();
                    i.src = r + "?v=" + Date.now();
                });
            });

            await Promise.all(promesas);

            document.getElementById('pWrap').style.display = "none";
            document.getElementById('status').innerText = "";

            if(encontradas.length > 0) {
                mostrarResultados(call, [...new Set(encontradas)]);
            } else {
                const err = document.getElementById('errorArea');
                err.innerHTML = `<div id="msgE" style="color:#ff6b6b; margin-top:20px; font-weight:bold; border:1px solid #ff6b6b; padding:10px; border-radius:10px; animation: shake 0.4s;">‚ùå NO SE ENCONTR√ì QSL PARA ${call}</div>`;
                setTimeout(() => {
                    const m = document.getElementById('msgE');
                    if(m) {
                        m.style.transition = "1s"; m.style.opacity = "0";
                        setTimeout(() => { err.innerHTML = ""; document.getElementById('indicativo').value = ""; }, 1000);
                    }
                }, 6000);
            }
        }

        function mostrarResultados(call, fotos) {
            const m = document.getElementById('modal');
            const g = document.getElementById('qslGrid');
            document.getElementById('modalTitle').innerText = "QSLs ENCONTRADAS PARA " + call;
            g.innerHTML = "";
            fotos.forEach(f => {
                g.innerHTML += `<div class="qsl-card"><img src="${f}"><br><a href="${f}" download class="dl-link">DESCARGAR</a></div>`;
            });
            m.style.display = "block";
        }

        function cerrarModal() { document.getElementById('modal').style.display = "none"; }
    </script>
</body>
</html>
