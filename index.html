<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Navegador QSL Caribe√±o - CL7ADV</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Nunito:wght@300;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      /* Paleta inspirada en colores de playa c√°lidos y marinos */
      --sea-deep: #0b6b7a;
      --sea-mid: #1aa3b8;
      --sand: #f3d9b6;
      --sun: #ffb74d;
      --muted: #3f2b1f;
      --card-bg: rgba(255,255,255,0.94);
      --radius-lg: 16px;
      --shadow-1: 0 14px 40px rgba(40,20,10,0.10);
      --neon-color: #ffd86b; /* warm neon for borders and glow */
      --neon-accent: #7ef0ff; /* cool neon accent for contrast */
      --transition-fast: 160ms;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Nunito",system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
      color:var(--muted);
      background: linear-gradient(180deg,#fffaf0,#fff6ee);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.45;
      padding:18px;
    }

    /* HERO: sunset beach background (place img/sunset-beach.jpg in img/) */
    .hero {
      position: relative;
      min-height: 48vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 36px 18px;
      background-image: url('img/sunset-beach.jpg');
      background-size: cover;
      background-position: center center;
      border-radius: 18px;
      box-shadow: var(--shadow-1);
      overflow: hidden;
    }
    .hero::before{
      content:"";
      position:absolute; inset:0;
      /* subtle warm overlay to enhance beach tones and legibility */
      background: linear-gradient(180deg, rgba(6,30,40,0.28), rgba(255,160,60,0.06) 60%);
      mix-blend-mode: multiply;
      pointer-events:none;
    }

    .hero-inner{
      position:relative; z-index:2; width:100%; max-width:1100px; display:flex; gap:20px; align-items:center; justify-content:space-between;
    }

    .brand { display:flex; gap:18px; align-items:center; }

    .logo {
      width:88px; height:88px; border-radius:14px;
      background: linear-gradient(180deg,#fff,#fff6ec);
      display:flex; align-items:center; justify-content:center;
      font-family:"Playfair Display",serif; font-weight:700; color:var(--sea-deep);
      font-size:1.1rem; box-shadow: 0 10px 30px rgba(0,0,0,0.18); border:1px solid rgba(255,255,255,0.35);
    }

    /* Elegant title with neon border effect */
    .hero-title {
      color: #fff;
      font-family: "Playfair Display", serif;
      font-size: 2.4rem;
      line-height:1.02;
      margin:0;
      letter-spacing:0.2px;
      /* neon border effect using layered text-shadows */
      text-shadow:
        0 0 2px rgba(255,255,255,0.9),
        0 0 6px var(--neon-color),
        0 0 12px rgba(255,180,80,0.6),
        0 6px 18px rgba(0,0,0,0.45);
    }

    .hero-sub {
      color: rgba(255,255,255,0.95);
      margin-top:8px;
      font-size:1rem;
      text-shadow: 0 6px 18px rgba(0,0,0,0.35);
    }

    /* Main container overlapping hero */
    .container {
      max-width:1100px; margin:-48px auto 28px; padding:24px;
      background: var(--card-bg); border-radius:var(--radius-lg); box-shadow: var(--shadow-1);
      border:1px solid rgba(180,120,60,0.06); position:relative; z-index:3;
    }

    .controls { display:flex; gap:12px; align-items:center; justify-content:center; flex-wrap:wrap; margin-bottom:14px; }
    #indicativo {
      padding:12px 14px; border-radius:12px; border:1px solid rgba(120,80,40,0.08);
      width:260px; font-size:1rem; background: linear-gradient(180deg,#fff,#fffaf3);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.6); color:var(--muted); outline:none;
      transition: box-shadow var(--transition-fast), transform var(--transition-fast);
    }
    #indicativo:focus { box-shadow: 0 8px 20px rgba(200,120,60,0.12); transform: translateY(-2px); }

    /* Neon-outlined button */
    #buscarBtn {
      padding:12px 18px; border-radius:12px; border:none;
      background: linear-gradient(180deg,var(--sea-mid), var(--sea-deep));
      color: #fff; font-weight:800; cursor:pointer;
      box-shadow: 0 10px 26px rgba(10,50,70,0.10);
      position:relative;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast);
    }
    /* neon border using pseudo-element */
    #buscarBtn::after {
      content: "";
      position: absolute;
      inset: -2px;
      border-radius: 12px;
      background: linear-gradient(90deg, rgba(255,216,107,0.12), rgba(126,240,255,0.06));
      box-shadow: 0 0 18px 4px rgba(255,216,107,0.06);
      z-index: -1;
      transition: opacity 160ms ease;
    }
    #buscarBtn:hover { transform: translateY(-3px); box-shadow: 0 14px 34px rgba(10,50,70,0.14); }
    #buscarBtn:active { transform: translateY(-1px); }

    /* Neon-styled headings and small accents */
    .section-title {
      font-family: "Playfair Display", serif;
      font-size:1.15rem;
      color: var(--sea-deep);
      margin: 8px 0 12px;
      text-shadow:
        0 0 2px rgba(255,255,255,0.9),
        0 0 8px var(--neon-accent),
        0 6px 12px rgba(0,0,0,0.08);
    }

    #resultado{ margin-top:14px; min-height:40px; text-align:center; color:var(--muted); }
    .mensaje{ font-size:1rem; color:var(--sea-deep); margin:8px 0; }

    /* QSL cards */
    #listaQSLs { display:flex; flex-wrap:wrap; gap:18px; justify-content:center; margin-top:12px; }
    .qsl-img{
      max-width:240px;
      border-radius:12px;
      border: 3px solid rgba(200,140,80,0.12);
      box-shadow: 0 12px 30px rgba(120,70,30,0.08);
      background: linear-gradient(180deg,#fff,#fff8f2);
      transition: transform .22s ease, box-shadow .22s ease;
    }
    .qsl-img:hover{ transform: translateY(-6px); box-shadow: 0 20px 40px rgba(120,70,30,0.12); }

    .descargar{
      display:inline-block;
      margin-top:10px;
      padding:9px 16px;
      border-radius:10px;
      background: linear-gradient(180deg,var(--sun), #ff9f3b);
      color:#fff;
      text-decoration:none;
      font-weight:800;
      box-shadow: 0 8px 18px rgba(200,120,40,0.08);
      transition: transform var(--transition-fast);
    }
    .descargar:hover{ transform: translateY(-3px); }

    /* Loader (card moving) */
    .loader-wrap{ display:none; margin-top:12px; align-items:center; justify-content:center; gap:12px; }
    .spinner{ width:22px; height:22px; border:3px solid rgba(120,80,40,0.12); border-top-color:var(--sun); border-radius:50%; animation:spin 1s linear infinite; }
    @keyframes spin{ to{ transform:rotate(360deg); } }
    .progress-bar{ position:relative; width:380px; height:14px; background: rgba(200,140,80,0.06); border-radius:10px; overflow:hidden; box-shadow: inset 0 2px 6px rgba(0,0,0,0.04); }
    .progress-fill{ height:100%; background: linear-gradient(90deg,#ffd89a,#ffb74d); width:0%; transition: width 160ms ease; }
    .card-thumb{ position:absolute; top:-30px; width:64px; height:40px; background: linear-gradient(180deg,#fff,#fff0df); color:#4a2f1a; border:2px solid rgba(200,140,80,0.18); border-radius:8px; display:flex; align-items:center; justify-content:center; font-weight:800; font-size:0.85rem; box-shadow: 0 8px 22px rgba(120,70,30,0.12); transform:translateX(-50%); transition:left 80ms cubic-bezier(.2,.8,.2,1); pointer-events:none; overflow:hidden; }
    .card-thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
    .progress-text{ font-size:0.95rem; color:#7a5a44; margin-top:8px; text-align:center; }

    /* Modal */
    .modal{ display:none; position:fixed; inset:0; z-index:1200; background: rgba(20,12,8,0.45); align-items:center; justify-content:center; padding:20px; }
    .modal-contenido{ width:100%; max-width:920px; background: linear-gradient(180deg,#fffaf0,#fff7ef); border-radius:14px; padding:18px; box-shadow: 0 20px 50px rgba(60,30,10,0.25); color:#3f2b1f; }
    .cerrar{ float:right; font-size:26px; cursor:pointer; color:#7a5a44; }

    @media (max-width:720px){
      .hero-inner{ flex-direction:column; gap:12px; text-align:center; }
      .hero-title{ font-size:1.6rem; }
      .container{ margin-top:-28px; padding:18px; }
      .progress-bar{ width:260px; }
      #indicativo{ width:160px; }
    }
  </style>
</head>
<body>
  <!-- Hero with sunset beach background -->
  <section class="hero" role="banner" aria-label="Portada atardecer en la playa">
    <div class="hero-inner">
      <div class="brand" aria-hidden="true">
        <div class="logo">CL7</div>
      </div>

      <div style="flex:1; max-width:720px; text-align:center;">
        <h1 class="hero-title">Navegador QSL Caribe√±o</h1>
        <p class="hero-sub">Busca y descarga tus QSL con estilo ‚Äî buenos DXs desde la costa</p>
      </div>
    </div>
  </section>

  <!-- Main content -->
  <main class="container" role="main">
    <div class="controls" aria-label="Controles de b√∫squeda">
      <input id="indicativo" type="text" placeholder="Ej: CL7ADV" aria-label="Indicativo">
      <button id="buscarBtn" type="button">Buscar QSL</button>
    </div>

    <!-- Loader with moving card -->
    <div id="loaderContainer" class="loader-wrap" aria-hidden="true">
      <div class="spinner" id="spinner" role="status" aria-hidden="true"></div>
      <div>
        <div class="progress-bar" id="progressBar">
          <div id="progressFill" class="progress-fill" style="width:0%"></div>
          <div id="cardThumb" class="card-thumb" style="left:0%"><img id="cardThumbImg" src="img/mini-qsl.jpg" alt="mini QSL" onerror="this.style.display='none'; this.parentElement.textContent='QSL'"></div>
        </div>
        <div id="progressText" class="progress-text">Iniciando b√∫squeda...</div>
      </div>
    </div>

    <div id="resultado" role="status" aria-live="polite"></div>

    <footer>
      ‚Äî CL7ADV ‚Äî Buenos DXs en este 2026 ¬∑ Radio Club Santa Cruz Del Sur/Alfred
    </footer>
  </main>

  <!-- Modal QSLs -->
  <div id="ventanaQSL" class="modal" aria-hidden="true">
    <div class="modal-contenido" role="dialog" aria-modal="true" aria-labelledby="qslTitle">
      <span class="cerrar" id="cerrarBtn" title="Cerrar">&times;</span>
      <h2 id="qslTitle" class="section-title">QSLs disponibles</h2>
      <div id="contador"></div>
      <div id="listaQSLs"></div>
      <br>
      <button class="descargar" id="descargarTodasBtn" type="button">‚¨áÔ∏è Descargar todas</button>
    </div>
  </div>

  <script>
    let totalQSLs = 0, descargadas = 0, listaActual = [], imagenCargada = false, timeoutId = null;

    window.onerror = function(message, source, lineno, colno, error) {
      console.error('ERROR GLOBAL:', message, 'at', source + ':' + lineno + ':' + colno);
      const resultado = document.getElementById('resultado');
      if (resultado) resultado.innerHTML = `<p class="mensaje">‚ö†Ô∏è Error: ${message} (ver consola)</p>`;
      return false;
    };

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('buscarBtn').addEventListener('click', buscarQSL);
      document.getElementById('cerrarBtn').addEventListener('click', cerrarVentana);
      document.getElementById('descargarTodasBtn').addEventListener('click', descargarTodas);
      document.getElementById('ventanaQSL').addEventListener('click', (e) => {
        if (e.target === document.getElementById('ventanaQSL')) cerrarVentana();
      });
    });

    function animateCardTo(cardElem, targetPct, duration = 90) {
      if (!cardElem) return;
      if (cardElem._animFrame) cancelAnimationFrame(cardElem._animFrame);
      const start = parseFloat(cardElem.style.left) || 0;
      const end = Math.max(0, Math.min(100, targetPct));
      const startTime = performance.now();
      function ease(t){ return t<0.5 ? 2*t*t : -1 + (4 - 2*t)*t; }
      function step(now){
        const t = Math.min(1, (now - startTime) / duration);
        const eased = ease(t);
        const current = start + (end - start) * eased;
        cardElem.style.left = current + '%';
        if (t < 1) cardElem._animFrame = requestAnimationFrame(step);
        else cardElem._animFrame = null;
      }
      cardElem._animFrame = requestAnimationFrame(step);
    }

    function buscarQSL(){
      imagenCargada = false;
      if (timeoutId){ clearTimeout(timeoutId); timeoutId = null; }

      const indicativo = document.getElementById("indicativo").value.trim().toUpperCase();
      const resultado = document.getElementById("resultado");
      const listaQSLs = document.getElementById("listaQSLs");
      resultado.innerHTML = ""; if (listaQSLs) listaQSLs.innerHTML = "";

      if (!indicativo){
        resultado.innerHTML = `<p class="mensaje">üå∫ Por favor escribe un indicativo</p>`;
        setTimeout(()=>{ resultado.innerHTML = ""; }, 4500);
        return;
      }

      const loader = document.getElementById('loaderContainer');
      const progressFill = document.getElementById('progressFill');
      const progressText = document.getElementById('progressText');
      const cardThumb = document.getElementById('cardThumb');
      if (loader) { loader.style.display = 'flex'; loader.setAttribute('aria-hidden','false'); }
      if (progressFill) progressFill.style.width = '0%';
      if (cardThumb) cardThumb.style.left = '0%';
      if (progressText) progressText.textContent = 'üîÑ Buscando QSL‚Ä¶';

      let posibles = []; posibles.push(`img/${indicativo}.jpg`);
      for (let i=1;i<=50;i++) posibles.push(`img/${indicativo}-${i}.jpg`);

      let encontradas = [], comprobadas = 0, totalPosibles = posibles.length;
      if (timeoutId) clearTimeout(timeoutId);

      function actualizarProgreso(){
        const pct = Math.round((comprobadas / totalPosibles) * 100);
        if (progressFill) progressFill.style.width = pct + '%';
        const offset = 12;
        const cardPos = Math.min(100, pct + offset);
        if (cardThumb) animateCardTo(cardThumb, cardPos, 80);
        if (progressText) progressText.textContent = `Comprobadas ${comprobadas} / ${totalPosibles} (${pct}%)`;
      }

      posibles.forEach(ruta=>{
        const img = new Image();
        img.onload = ()=>{
          comprobadas++; actualizarProgreso();
          if (!encontradas.includes(ruta)){
            imagenCargada = true; encontradas.push(ruta);
            mostrarQSLs(encontradas, indicativo);
            if (progressFill) progressFill.style.width = '100%';
            if (cardThumb) animateCardTo(cardThumb, 100, 80);
            if (progressText) progressText.textContent = `Se encontraron ${encontradas.length} QSL`;
            setTimeout(()=>{ if (loader) { loader.style.display='none'; loader.setAttribute('aria-hidden','true'); } }, 700);
          }
        };
        img.onerror = ()=>{
          comprobadas++; actualizarProgreso();
          if (comprobadas >= totalPosibles && !imagenCargada){
            setTimeout(()=>{ if (loader) { loader.style.display='none'; loader.setAttribute('aria-hidden','true'); } }, 300);
          }
        };
        img.src = ruta;
      });

      timeoutId = setTimeout(()=>{
        if (!imagenCargada){
          resultado.innerHTML = `<p class="mensaje">‚ùå No tenemos esa QSL, pero pronto estar√° lista üå∫</p>`;
          if (progressText) progressText.textContent = 'B√∫squeda finalizada: no se encontraron im√°genes';
          setTimeout(()=>{ if (loader) { loader.style.display='none'; loader.setAttribute('aria-hidden','true'); } }, 900);
        }
      }, 10000);
    }

    function mostrarQSLs(lista, indicativo){
      const ventana = document.getElementById("ventanaQSL");
      const listaQSLs = document.getElementById("listaQSLs");
      if (!lista || lista.length===0) return;
      if (listaQSLs) listaQSLs.innerHTML = `<p class="mensaje">üì° Se encontraron ${lista.length} QSL para <strong>${indicativo}</strong></p>`;
      totalQSLs = lista.length; descargadas = 0; listaActual = lista.slice();
      actualizarContador();
      lista.forEach(ruta=>{
        if (listaQSLs) listaQSLs.innerHTML += `
          <div>
            <img src="${ruta}" alt="QSL de ${indicativo}" class="qsl-img">
            <br>
            <a href="${ruta}" download class="descargar" onclick="marcarDescarga()">‚¨áÔ∏è Descargar QSL</a>
          </div>
        `;
      });
      if (ventana) { ventana.style.display = "flex"; ventana.setAttribute('aria-hidden','false'); }
    }

    function actualizarContador(){
      const contador = document.getElementById("contador");
      if (contador) contador.innerHTML = `<p class="mensaje">Has descargado ${descargadas} de ${totalQSLs} QSL</p>`;
    }

    function marcarDescarga(){
      descargadas++; actualizarContador();
      if (descargadas >= totalQSLs){
        const listaQSLs = document.getElementById("listaQSLs");
        if (listaQSLs) listaQSLs.innerHTML = `<p class="mensaje">‚úÖ Has descargado todas tus QSL, buenos DXs üå∫</p>`;
        setTimeout(()=>{ cerrarVentana(); document.getElementById("resultado").innerHTML=""; document.getElementById("indicativo").value=""; }, 1600);
      }
    }

    function descargarTodas(){
      if (!listaActual || listaActual.length===0) return;
      listaActual.forEach(ruta=>{
        const link = document.createElement("a");
        link.href = ruta; link.download = ruta.split("/").pop();
        document.body.appendChild(link); link.click(); document.body.removeChild(link);
        descargadas++;
      });
      actualizarContador();
      if (descargadas >= totalQSLs){
        const listaQSLs = document.getElementById("listaQSLs");
        if (listaQSLs) listaQSLs.innerHTML = `<p class="mensaje">‚úÖ Has descargado todas tus QSL, buenos DXs üå∫</p>`;
        setTimeout(()=>{ cerrarVentana(); document.getElementById("resultado").innerHTML=""; document.getElementById("indicativo").value=""; }, 1600);
      }
    }

    function cerrarVentana(){
      const ventana = document.getElementById("ventanaQSL");
      if (ventana) { ventana.style.display = "none"; ventana.setAttribute('aria-hidden','true'); }
    }
  </script>
</body>
</html>
