<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>QSL Caribe√±o & Tools - CL7ADV</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root {
      --primary: #00bcd4;
      --primary-dark: #009688;
      --accent: #ff9800;
      --gold: #ffe082;
      --nav-bg: #1e3a47;
    }

    body { 
      margin: 0; 
      font-family: "Trebuchet MS", Arial, sans-serif; 
      background: linear-gradient(to bottom, var(--primary), var(--primary-dark)); 
      color: #fff; 
      min-height: 100vh;
      text-align: center;
    }

    /* BARRA SUPERIOR */
    .top-nav {
      background: var(--nav-bg);
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .brand { font-weight: bold; font-size: 1.2rem; display: flex; align-items: center; gap: 10px; }

    .nav-buttons { display: flex; gap: 10px; }

    .nav-btn {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      color: white;
      padding: 8px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: 0.3s;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .nav-btn:hover, .nav-btn.active { background: var(--accent); border-color: var(--accent); }

    /* CONTENEDORES PRINCIPALES */
    .container { 
      max-width: 950px; 
      margin: 30px auto; 
      padding: 30px; 
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(10px);
      border-radius: 20px; 
      box-shadow: 0 15px 35px rgba(0,0,0,0.5);
    }

    .section { display: none; animation: fadeIn 0.5s ease; }
    .section.active { display: block; }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* FORMULARIOS */
    .tool-box {
      background: rgba(255,255,255,0.9);
      padding: 25px;
      border-radius: 15px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      margin: 20px 0;
    }

    .tool-box input {
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      outline: none;
    }

    .tool-box input:focus { border-color: var(--primary); }

    .action-btn {
      padding: 12px 25px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      text-transform: uppercase;
    }

    /* LOADER PERSONALIZADO CL7ADV */
    .loader-wrap { display: none; flex-direction: column; align-items: center; margin: 20px; }
    .progress-bar { 
      width: 300px; height: 14px; background: rgba(255,224,130,0.2); 
      border-radius: 10px; position: relative; margin-top: 30px;
    }
    .progress-fill { height: 100%; background: var(--gold); width: 0%; border-radius: 10px; transition: 0.2s; }
    .card-thumb { 
      position: absolute; top: -35px; width: 50px; height: 30px; 
      background: #fff; color: #000; border: 2px solid var(--gold);
      border-radius: 6px; font-weight: bold; font-size: 0.7rem;
      display: flex; align-items: center; justify-content: center; transform: translateX(-50%);
    }

    /* MODAL Y QSLs */
    .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); }
    .modal-content { background: #fff; color: #333; margin: 5% auto; padding: 25px; border-radius: 15px; width: 90%; max-width: 900px; max-height: 80vh; overflow-y: auto; }
    .qsl-card { background: #f9f9f9; padding: 10px; border: 3px solid var(--gold); border-radius: 12px; }
    .qsl-img { width: 100%; max-width: 250px; border-radius: 8px; }

    footer { margin-top: 50px; color: var(--gold); font-size: 0.9rem; padding-bottom: 20px;}
  </style>
</head>
<body>

  <nav class="top-nav">
    <div class="brand">
      <span>üå¥ CL7ADV Radio Tools</span>
    </div>
    <div class="nav-buttons">
      <button class="nav-btn active" onclick="showSection('busqueda')">üîç Buscar QSL</button>
      <button class="nav-btn" onclick="showSection('escudos')">üõ°Ô∏è Crear Escudo</button>
    </div>
  </nav>

  <div class="container">
    
    <div id="busqueda" class="section active">
      <h1>üåä Buscador de Tarjetas QSL</h1>
      <p>Sintoniza tu indicativo para descargar tus contactos confirmados.</p>
      
      <div class="tool-box">
        <input type="text" id="indicativo" placeholder="Ej: CL7ADV" autocomplete="off">
        <button class="action-btn" onclick="iniciarBusqueda()">Buscar</button>
      </div>

      <div id="loaderContainer" class="loader-wrap">
        <div class="progress-bar">
          <div id="progressFill" class="progress-fill"></div>
          <div id="cardThumb" class="card-thumb" style="left:0%;">TX...</div>
        </div>
        <p id="progressText" style="margin-top:15px; color: var(--gold);"></p>
      </div>
      <div id="resultado"></div>
    </div>

    <div id="escudos" class="section">
      <h1>üõ°Ô∏è Generador de Patente y Escudo</h1>
      <p>Personaliza tu insignia de radioaficionado GADTM.</p>
      
      <div class="tool-box">
        <input type="text" id="licencia" placeholder="Licencia">
        <input type="text" id="nombre" placeholder="Nombre">
        <input type="text" id="locator" placeholder="Locator">
        <button class="action-btn" style="background: var(--primary-dark);">Generar Escudo</button>
      </div>

      <div id="canvasPreview" style="margin-top:20px; border: 2px dashed var(--gold); padding: 50px; border-radius: 15px;">
        <p>Previsualizaci√≥n del Escudo</p>
      </div>
    </div>

    <footer>
      <p>‚Äî Motor del Proyecto: Radio Club Santa Cruz Del Sur / Alfred ‚Äî</p>
      <a href="https://info.flagcounter.com/qvMz" target="_blank">
        <img src="https://s01.flagcounter.com/count2/qvMz/bg_57A8DE/txt_000000/border_F55B0F/columns_5/maxflags_20/viewers_0/labels_0/pageviews_0/flags_0/percent_0/" alt="Flag Counter" border="0">
      </a>
    </footer>
  </div>

  <div id="ventanaQSL" class="modal">
    <div class="modal-content">
      <span onclick="cerrarModal()" style="float:right; cursor:pointer; font-size: 2rem;">&times;</span>
      <h2 style="color: var(--primary-dark)">üì° QSLs Encontradas</h2>
      <div id="contador" style="margin-bottom: 20px; font-weight: bold;"></div>
      <div id="listaQSLs" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 20px;"></div>
      <br>
      <button class="action-btn" onclick="descargarTodas()" style="background: #2e7d32; border:none;">‚¨áÔ∏è Descargar Galer√≠a</button>
    </div>
  </div>

  <script>
    const FORMATOS = ['jpg', 'png', 'webp', 'jpeg'];
    let encontradas = [];

    // CAMBIAR SECCIONES (TABS)
    function showSection(sectionId) {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
      
      document.getElementById(sectionId).classList.add('active');
      event.currentTarget.classList.add('active');
    }

    // L√ìGICA DE B√öSQUEDA QSL (SIN DUPLICADOS)
    async function iniciarBusqueda() {
      const ind = document.getElementById("indicativo").value.trim().toUpperCase();
      if (!ind) return alert("Escribe un indicativo");

      encontradas = [];
      document.getElementById('listaQSLs').innerHTML = '';
      document.getElementById('resultado').innerHTML = '';
      document.getElementById('loaderContainer').style.display = 'flex';
      
      let rutas = [];
      FORMATOS.forEach(ext => {
        rutas.push(`img/${ind}.${ext}`);
        for(let i=1; i<=20; i++) rutas.push(`img/${ind}-${i}.${ext}`);
      });

      let total = rutas.length;
      let count = 0;

      for (let r of rutas) {
        verificarImagen(r).then(existe => {
          count++;
          if (existe && !encontradas.includes(r)) {
            encontradas.push(r);
            renderizarQSL(r, ind);
            document.getElementById('ventanaQSL').style.display = 'block';
          }
          actualizarProgreso(count, total);
        });
      }
    }

    function verificarImagen(url) {
      return new Promise(resolve => {
        const i = new Image();
        i.onload = () => resolve(true);
        i.onerror = () => resolve(false);
        i.src = url;
      });
    }

    function renderizarQSL(ruta, ind) {
      const container = document.getElementById('listaQSLs');
      const div = document.createElement('div');
      div.className = 'qsl-card';
      div.innerHTML = `<img src="${ruta}" class="qsl-img"><br><a href="${ruta}" download class="action-btn" style="padding:5px 10px; font-size:0.8rem; text-decoration:none; margin-top:5px; display:inline-block;">‚¨áÔ∏è Bajar</a>`;
      container.appendChild(div);
      document.getElementById('contador').textContent = `Hemos localizado ${encontradas.length} tarjetas para ${ind}`;
    }

    function actualizarProgreso(act, tot) {
      const p = Math.round((act / tot) * 100);
      document.getElementById('progressFill').style.width = p + '%';
      document.getElementById('cardThumb').style.left = p + '%';
      document.getElementById('progressText').textContent = `Escaneando frecuencias... ${p}%`;
      if (act === tot) setTimeout(() => {
        document.getElementById('loaderContainer').style.display = 'none';
        if(encontradas.length === 0) document.getElementById('resultado').innerHTML = '‚ùå No se encontraron QSL.';
      }, 1000);
    }

    function cerrarModal() { document.getElementById('ventanaQSL').style.display = 'none'; }

    function descargarTodas() {
      encontradas.forEach((r, i) => {
        setTimeout(() => {
          const a = document.createElement("a");
          a.href = r;
          a.download = r.split("/").pop();
          a.click();
        }, i * 400);
      });
    }
  </script>
</body>
</html>
