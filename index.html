<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QSL Cloud Engine - CL7ADV</title>
    <style>
        :root { --cuba-azul: #002A8F; --cuba-rojo: #D21034; --bg: #f8f9fa; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; }
        
        /* HEADER ESTILO CARIBE */
        header { background: var(--cuba-azul); color: white; padding: 25px; text-align: center; border-bottom: 6px solid var(--cuba-rojo); position: relative; }
        .firma-top { font-size: 2.8em; font-weight: 900; letter-spacing: 5px; cursor: pointer; display: inline-block; }
        
        .search-section { max-width: 800px; margin: 40px auto; padding: 0 20px; text-align: center; }
        .bar-container { display: flex; background: white; border-radius: 50px; padding: 10px 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); border: 2px solid #eee; }
        input { border: none; outline: none; flex: 1; font-size: 1.3em; text-transform: uppercase; padding: 10px; }
        .btn-search { background: var(--cuba-azul); color: white; border: none; padding: 10px 40px; border-radius: 50px; font-weight: bold; cursor: pointer; font-size: 1.1em; transition: 0.3s; }
        .btn-search:hover { background: var(--cuba-rojo); transform: scale(1.05); }

        /* MOSAICO DE RESULTADOS */
        .qsl-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; max-width: 1200px; margin: 40px auto; padding: 20px; }
        .qsl-item { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.08); border: 1px solid #ddd; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .qsl-item img { width: 100%; height: auto; cursor: pointer; display: block; }
        .qsl-meta { padding: 15px; background: #fff; border-top: 1px solid #eee; text-align: center; font-weight: bold; color: var(--cuba-azul); }

        /* VISTA PREVIA (MODAL) */
        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.9); z-index: 2000; align-items: center; justify-content: center; flex-direction: column; }
        .modal img { max-width: 95%; max-height: 75vh; border: 4px solid white; border-radius: 10px; }
        .modal-tools { margin-top: 25px; display: flex; gap: 20px; }
        .btn-dl { background: #28a745; color: white; padding: 15px 40px; border-radius: 8px; text-decoration: none; font-weight: bold; font-size: 1.1em; }
        .btn-x { background: #444; color: white; border: none; padding: 15px 30px; border-radius: 8px; cursor: pointer; }

        footer { text-align: center; padding: 50px; color: #aaa; font-size: 0.9em; border-top: 1px solid #eee; margin-top: 50px; }
    </style>
</head>
<body>

    <header>
        <div class="firma-top" onclick="adminLink()">CL7ADV</div>
        <div style="font-size: 0.8em; letter-spacing: 2px;">LOGBOOK SERVER • SANTA CRUZ DEL SUR</div>
    </header>

    <div class="search-section">
        <h1 style="color: var(--cuba-azul); margin-bottom: 30px;">Buscador de QSL & Certificados</h1>
        <div class="bar-container">
            <input type="text" id="callsign" placeholder="Ingresa indicativo..." onkeyup="if(event.keyCode===13) buscarQSL()">
            <button class="btn-search" onclick="buscarQSL()">BUSCAR</button>
        </div>
        <p style="color: #888; margin-top: 15px; font-size: 0.9em;">Resultados para estaciones colaboradoras como <b>CO5ABC</b>.</p>
    </div>

    <div id="mosaico" class="qsl-grid"></div>

    <div id="modalView" class="modal">
        <img id="imgFull">
        <div class="modal-tools">
            <a id="linkDl" class="btn-dl" download>GUARDAR QSL</a>
            <button class="btn-x" onclick="cerrar()">CERRAR</button>
        </div>
    </div>

    <footer>
        Sistema Operado por CL7ADV © 2026<br>
        Tecnología de Búsqueda en la Nube
    </footer>

    <script>
        const CLAVE = "CUBA73";
        let clicks = 0;

        function adminLink() {
            clicks++;
            if(clicks === 5) {
                const p = prompt("ACCESO RESTRINGIDO CL7ADV:");
                if(p === CLAVE) window.open("https://drive.google.com/drive/folders/1fJxjff9vtOR0SU7lq3lBHoGrGgvAUq1q", "_blank");
                clicks = 0;
            }
            setTimeout(()=> clicks = 0, 2000);
        }

        async function buscarQSL() {
            const ind = document.getElementById('callsign').value.toUpperCase().trim();
            const mosaico = document.getElementById('mosaico');
            if(!ind) return;

            mosaico.innerHTML = "<h4>Procesando motor de búsqueda...</h4>";
            
            // Intentamos buscar archivos con formato: INDICATIVO.jpg, INDICATIVO_1.jpg, INDICATIVO_2.jpg
            const variantes = [`${ind}.jpg`, `${ind}_1.jpg`, `${ind}_2.jpg`, `${ind}_3.jpg`];
            let encontradas = 0;
            mosaico.innerHTML = "";

            for(let v of variantes) {
                const ruta = `tarjetas/${v}`;
                const existe = await comprobarImagen(ruta);
                if(existe) {
                    encontradas++;
                    mosaico.innerHTML += `
                        <div class="qsl-item">
                            <img src="${ruta}" onclick="ver('${ruta}')">
                            <div class="qsl-meta">${v}</div>
                        </div>
                    `;
                }
            }

            if(encontradas === 0) {
                mosaico.innerHTML = "<p>No se encontraron tarjetas para <b>"+ind+"</b> en el servidor.</p>";
            }
        }

        function comprobarImagen(url) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => resolve(true);
                img.onerror = () => resolve(false);
                img.src = url;
            });
        }

        function ver(src) {
            document.getElementById('imgFull').src = src;
            document.getElementById('linkDl').href = src;
            document.getElementById('modalView').style.display = 'flex';
        }

        function cerrar() {
            document.getElementById('modalView').style.display = 'none';
        }
    </script>
</body>
</html>
