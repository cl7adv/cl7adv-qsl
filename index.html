<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>QSL Caribeña v32.6 - SECURE ADMIN</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
    <style>
        :root {
            --n-blue: #00eaff;
            --n-pink: #ff00ff;
            --bg: #010409;
        }

        body { 
            margin: 0; background: var(--bg); color: white; 
            font-family: 'Segoe UI', sans-serif;
            background-image: radial-gradient(circle at 2px 2px, rgba(0, 234, 255, 0.1) 1px, transparent 0);
            background-size: 24px 24px;
        }

        /* --- NAVEGACIÓN --- */
        .top-nav {
            background: rgba(0,0,0,0.95); height: 70px; display: flex;
            justify-content: space-between; align-items: center; padding: 0 25px;
            border-bottom: 2px solid var(--n-blue); position: sticky; top: 0; z-index: 1000;
        }

        .btn-admin {
            background: #222; color: var(--n-blue); border: 1px solid var(--n-blue);
            padding: 8px 15px; border-radius: 5px; cursor: pointer; font-weight: bold;
        }
        .btn-admin.active { background: var(--n-pink); color: white; border-color: white; }

        /* --- INTERFAZ PRINCIPAL --- */
        .wrapper { width: 95%; max-width: 900px; margin: 40px auto; text-align: center; }

        .glass-card {
            background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 40px; padding: 40px 20px; backdrop-filter: blur(10px);
        }

        input#callsign {
            width: 85%; max-width: 400px; padding: 20px; border-radius: 20px;
            background: #000; border: 3px solid var(--n-blue); color: #fff;
            font-size: 2.5rem; text-align: center; font-weight: 900; text-transform: uppercase;
            box-shadow: 0 0 20px rgba(0, 234, 255, 0.2); outline: none;
        }

        .btn-generate {
            margin-top: 30px; padding: 20px 60px; border-radius: 50px;
            background: linear-gradient(90deg, #0051ff, #ff3131);
            color: white; font-weight: 900; border: none; cursor: pointer;
            font-size: 1.3rem; text-transform: uppercase; transition: 0.3s;
        }

        /* --- GALERÍA DE TARJETAS --- */
        .gallery-container { margin-top: 50px; text-align: left; }
        .gallery-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 20px; margin-top: 20px;
        }

        .qsl-box {
            position: relative; aspect-ratio: 3/2; background: #000;
            border-radius: 15px; border: 2px solid #333; cursor: pointer;
            overflow: hidden; transition: 0.3s;
        }
        .qsl-box.selected { border-color: var(--n-blue); box-shadow: 0 0 20px var(--n-blue); }
        .qsl-box img { width: 100%; height: 100%; object-fit: cover; }

        .delete-overlay {
            position: absolute; top: 5px; right: 5px; background: red;
            color: white; width: 25px; height: 25px; border-radius: 50%;
            display: none; justify-content: center; align-items: center;
            font-weight: bold; font-size: 12px; z-index: 10;
        }

        .upload-zone {
            margin-top: 30px; padding: 30px; border: 2px dashed #444;
            border-radius: 20px; background: rgba(255,255,255,0.02);
        }

        /* --- MODAL --- */
        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: #000; z-index: 5000; overflow-y: auto; }
        canvas { max-width: 95%; width: 850px; display: block; margin: 40px auto; border-radius: 20px; }

        .btn-group { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); display: flex; gap: 15px; }
        .btn-small { padding: 15px 30px; border-radius: 50px; border: none; color: white; font-weight: bold; cursor: pointer; }

        footer { padding: 50px; text-align: center; opacity: 0.3; font-size: 0.8rem; }
    </style>
</head>
<body onload="init()">

    <div class="top-nav">
        <div id="utc-clock" style="font-family: monospace; color: var(--n-blue); font-weight: bold; font-size: 1.2rem;">00:00:00 UTC</div>
        <button id="adminBtn" class="btn-admin" onclick="authAdmin()">MODO CREADOR</button>
    </div>

    <div class="wrapper">
        <div class="glass-card">
            <h1 style="margin:0; font-size: 2.8rem; letter-spacing: -1px;">QSL CARIBEÑA <span style="font-size: 0.8rem; vertical-align: middle; color: var(--n-pink);">v32.6</span></h1>
            <p style="color: #666; font-weight: bold; letter-spacing: 5px; margin-bottom: 30px;">ZMR REPEATER NETWORK</p>

            <input type="text" id="callsign" placeholder="TU INDICATIVO" maxlength="12">
            <br>
            <button class="btn-generate" onclick="generate()">GENERAR TARJETA</button>
        </div>

        <div class="gallery-container">
            <h3 style="color: var(--n-blue); border-left: 4px solid var(--n-pink); padding-left: 15px;">BIBLIOTECA DE ACTIVIDADES</h3>
            <div class="gallery-grid" id="mainGrid"></div>

            <div class="upload-zone">
                <p style="font-size: 0.8rem; color: #888; margin-bottom: 15px;">¿TIENES UNA PROPUESTA? SUBE TU IMAGEN AQUÍ:</p>
                <input type="file" id="fIn" accept="image/*">
            </div>
        </div>
    </div>

    <div id="modal" class="modal">
        <canvas id="output"></canvas>
        <div class="btn-group">
            <button class="btn-small" style="background:#ff3131;" onclick="saveImg()">DESCARGAR</button>
            <button class="btn-small" style="background:#333;" onclick="closeM()">VOLVER</button>
        </div>
    </div>

    <footer>CL7ADV &bull; ALFRED &bull; 2026 &bull; CUBA</footer>

    <script>
        let isAdmin = false;
        let selectedIdx = 0;
        let db = JSON.parse(localStorage.getItem('zmr_v32_db')) || [
            "https://via.placeholder.com/800x500/010409/00eaff?text=PLANTILLA+OFICIAL+ZMR"
        ];

        function init() {
            render();
            setInterval(() => {
                const d = new Date();
                document.getElementById('utc-clock').innerText = d.getUTCHours().toString().padStart(2,'0') + ":" + d.getUTCMinutes().toString().padStart(2,'0') + ":" + d.getUTCSeconds().toString().padStart(2,'0') + " UTC";
            }, 1000);
        }

        function render() {
            const grid = document.getElementById('mainGrid');
            grid.innerHTML = "";
            db.forEach((img, i) => {
                const div = document.createElement('div');
                div.className = `qsl-box ${selectedIdx === i ? 'selected' : ''}`;
                div.onclick = () => { if(!isAdmin) { selectedIdx = i; render(); } };
                
                div.innerHTML = `
                    <div class="delete-overlay" style="display: ${isAdmin ? 'flex' : 'none'}" onclick="deleteImg(${i})">X</div>
                    <img src="${img}">
                `;
                grid.appendChild(div);
            });
        }

        document.getElementById('fIn').onchange = function(e) {
            const reader = new FileReader();
            reader.onload = function() {
                db.push(reader.result);
                localStorage.setItem('zmr_v32_db', JSON.stringify(db));
                render();
            };
            reader.readAsDataURL(e.target.files[0]);
        };

        function generate() {
            const call = document.getElementById('callsign').value.trim().toUpperCase();
            if(!call) return alert("Ingresa un indicativo");

            const canvas = document.getElementById('output');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            img.onload = function() {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);

                ctx.fillStyle = "white";
                ctx.strokeStyle = "black";
                ctx.lineWidth = canvas.width * 0.01;
                ctx.font = `italic 900 ${canvas.width * 0.08}px Arial`;
                ctx.textAlign = "center";
                
                ctx.strokeText(call, canvas.width / 2, canvas.height * 0.85);
                ctx.fillText(call, canvas.width / 2, canvas.height * 0.85);

                document.getElementById('modal').style.display = 'block';
            };
            img.src = db[selectedIdx];
        }

        // FUNCIONES DE ADMINISTRADOR CON NUEVA CLAVE
        function authAdmin() {
            const p = prompt("CLAVE DE CREADOR:");
            if(p === "Leila2026") { // <--- Clave actualizada aquí
                isAdmin = !isAdmin;
                document.getElementById('adminBtn').classList.toggle('active');
                document.getElementById('adminBtn').innerText = isAdmin ? "SALIR MODO EDICIÓN" : "MODO CREADOR";
                render();
            } else {
                alert("Clave incorrecta. Acceso denegado.");
            }
        }

        function deleteImg(index) {
            if(confirm("¿Seguro que quieres eliminar esta tarjeta?")) {
                db.splice(index, 1);
                localStorage.setItem('zmr_v32_db', JSON.stringify(db));
                if(selectedIdx >= db.length) selectedIdx = 0;
                render();
            }
        }

        function saveImg() {
            const l = document.createElement('a');
            l.download = `QSL_${document.getElementById('callsign').value}.png`;
            l.href = document.getElementById('output').toDataURL();
            l.click();
        }

        function closeM() { document.getElementById('modal').style.display = 'none'; }
    </script>
</body>
</html>
