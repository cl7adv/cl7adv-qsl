<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QSL Caribe — Generador 3D Técnico</title>

  <style>
    /* Fondo general 3D técnico */
    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, Segoe UI, Arial;
      background: radial-gradient(circle at 50% 20%, #0a1a2a, #030b14 70%);
      color: #eaf6ff;
    }

    header {
      padding: 20px;
      background: #0c2c45;
      color: #fff;
      text-shadow: 0 0 12px rgba(0, 150, 255, 0.4);
    }

    main {
      display: grid;
      grid-template-columns: 350px 1fr;
      gap: 20px;
      padding: 20px;
    }

    .panel {
      background: rgba(10, 20, 35, 0.65);
      backdrop-filter: blur(12px);
      border-radius: 14px;
      padding: 20px;
      border: 1px solid rgba(80, 160, 255, 0.25);
      box-shadow:
        inset 0 0 12px rgba(0, 150, 255, 0.15),
        0 8px 20px rgba(0, 0, 0, 0.45);
    }

    h1, h2 {
      margin-top: 0;
    }

    label {
      font-size: 12px;
      color: #9ec7ff;
      margin-bottom: 4px;
      display: block;
    }

    input, select, textarea {
      background: rgba(5, 12, 22, 0.8);
      border: 1px solid rgba(80, 160, 255, 0.25);
      color: #eaf6ff;
      border-radius: 8px;
      padding: 8px;
      width: 100%;
      margin-bottom: 10px;
      box-shadow: inset 0 0 8px rgba(0, 150, 255, 0.15);
    }

    textarea {
      min-height: 70px;
      resize: vertical;
    }

    button {
      padding: 10px 16px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      margin: 4px;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    button.primary {
      background: linear-gradient(180deg, #3fd0c9, #1a8f89);
      color: #06121f;
      box-shadow: 0 4px 10px rgba(63, 208, 201, 0.4);
    }

    button.secondary {
      background: linear-gradient(180deg, #ffd36e, #c79a32);
      color: #06121f;
      box-shadow: 0 4px 10px rgba(255, 211, 110, 0.4);
    }

    button.danger {
      background: linear-gradient(180deg, #ff6b6b, #c73a3a);
      color: white;
      box-shadow: 0 4px 10px rgba(255, 107, 107, 0.4);
    }

    button.info {
      background: linear-gradient(180deg, #6ec1ff, #2c7ed6);
      color: #06121f;
      box-shadow: 0 4px 10px rgba(110, 193, 255, 0.4);
    }

    button:active {
      transform: translateY(2px);
      box-shadow: 0 2px 6px rgba(0,0,0,0.4);
    }

    #qslCanvas {
      background: #0b1624;
      border-radius: 16px;
      box-shadow:
        0 20px 40px rgba(0, 0, 0, 0.6),
        0 0 25px rgba(0, 150, 255, 0.25),
        inset 0 0 20px rgba(0, 150, 255, 0.15);
      transform: perspective(900px) rotateX(4deg);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      width: 100%;
      height: auto;
    }

    #qslCanvas:hover {
      transform: perspective(900px) rotateX(0deg);
      box-shadow:
        0 30px 60px rgba(0, 0, 0, 0.7),
        0 0 35px rgba(0, 150, 255, 0.35),
        inset 0 0 25px rgba(0, 150, 255, 0.25);
    }

    /* Mensaje de QSL no encontrada */
    #noQslMessage {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(180, 30, 60, 0.95);
      color: #fff;
      padding: 12px 20px;
      border-radius: 10px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.6);
      font-weight: 600;
      z-index: 9999;
      display: none;
    }

    #noQslMessage span {
      display: block;
      font-size: 13px;
      opacity: 0.9;
      margin-top: 4px;
    }

    @media (max-width: 800px) {
      main {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <header>
    <h1>QSL Caribe — Generador 3D Técnico</h1>
    <p>Tarjetas QSL técnicas en vista 3D, listas para imprimir o guardar</p>
  </header>

  <!-- Mensaje flotante de QSL no encontrada -->
  <div id="noQslMessage">
    QSL no encontrada en el sistema.
    <span>Regresando al inicio en 10 segundos…</span>
  </div>

  <main>
    <section class="panel">
      <h2>Datos del QSO</h2>
      <form id="qsoForm">
        <label for="indicativo">Indicativo</label>
        <input id="indicativo" placeholder="CM2ABC" required />

        <label for="nombre">Nombre del operador</label>
        <input id="nombre" placeholder="Alfred" />

        <label for="ubicacion">QTH / Ubicación</label>
        <input id="ubicacion" placeholder="Santa Cruz del Sur, Camagüey, Cuba" />

        <label for="pais">País</label>
        <input id="pais" placeholder="Cuba" />

        <label for="fecha">Fecha</label>
        <input id="fecha" type="date" />

        <label for="hora">Hora (UTC)</label>
        <input id="hora" type="time" />

        <label for="frecuencia">Frecuencia (MHz)</label>
        <input id="frecuencia" placeholder="14.070" />

        <label for="modo">Modo</label>
        <select id="modo">
          <option>SSB</option>
          <option>CW</option>
          <option>FT8</option>
          <option>FM</option>
          <option>AM</option>
          <option>DIGI</option>
        </select>

        <label for="rst">Señal (RST)</label>
        <input id="rst" placeholder="59 / 599" />

        <label for="qsl">QSL vía</label>
        <input id="qsl" placeholder="Directa / Buro / eQSL / LoTW" />

        <label for="notas">Notas</label>
        <textarea id="notas" placeholder="Gracias por el QSO. 73 y DX!"></textarea>

        <label for="fondo">Imagen de fondo</label>
        <input id="fondo" type="file" accept="image/*">

        <div>
          <button type="button" class="primary" id="btnGenerar">Generar tarjeta</button>
          <button type="button" class="secondary" id="btnDescargar">Descargar PNG</button>
          <button type="button" class="secondary" id="btnImprimir">Imprimir</button>
          <button type="button" class="danger" id="btnLimpiar">Limpiar</button>
        </div>

        <!-- Botón de ejemplo para mostrar QSL no encontrada -->
        <div style="margin-top:10px;">
          <button type="button" class="info" id="btnSimularNoQsl">
            Simular QSL no encontrada
          </button>
        </div>
      </form>
    </section>

    <section class="panel">
      <h2>Vista previa</h2>
      <canvas id="qslCanvas" width="1200" height="800"></canvas>
    </section>
  </main>

  <script>
    const form = document.getElementById('qsoForm');
    const canvas = document.getElementById('qslCanvas');
    const ctx = canvas.getContext('2d');
    const fondoInput = document.getElementById('fondo');
    const noQslMessage = document.getElementById('noQslMessage');

    const fontTitle = "700 62px system-ui, Segoe UI, Arial";
    const fontLabel = "700 20px system-ui, Segoe UI, Arial";
    const fontText  = "400 22px system-ui, Segoe UI, Arial";

    document.getElementById('btnGenerar').addEventListener('click', () => drawCard(readData()));
    document.getElementById('btnDescargar').addEventListener('click', downloadPNG);
    document.getElementById('btnImprimir').addEventListener('click', () => window.print());
    document.getElementById('btnLimpiar').addEventListener('click', () => {
      form.reset();
      drawCard(defaultData());
    });

    // Botón para simular "QSL no encontrada"
    document.getElementById('btnSimularNoQsl').addEventListener('click', () => {
      mostrarQslNoEncontrada();
    });

    // Dibuja una tarjeta inicial por defecto
    drawCard(defaultData());

    function defaultData() {
      const ahora = new Date();
      return {
        indicativo: "CM2ABC",
        nombre: "Alfred",
        ubicacion: "Santa Cruz del Sur, Camagüey",
        pais: "Cuba",
        fecha: ahora.toISOString().slice(0,10),
        hora: ahora.toISOString().slice(11,16),
        frecuencia: "14.070",
        modo: "SSB",
        rst: "59",
        qsl: "eQSL / LoTW",
        notas: "Gracias por el QSO. 73 y DX!"
      };
    }

    function readData() {
      const get = id => document.getElementById(id).value.trim();
      return {
        indicativo: get("indicativo") || "—",
        nombre: get("nombre"),
        ubicacion: get("ubicacion"),
        pais: get("pais"),
        fecha: get("fecha"),
        hora: get("hora"),
        frecuencia: get("frecuencia"),
        modo: get("modo"),
        rst: get("rst"),
        qsl: get("qsl"),
        notas: get("notas"),
      };
    }

    function downloadPNG() {
      const url = canvas.toDataURL("image/png");
      const a = document.createElement("a");
      a.href = url;
      a.download = `QSL_${Date.now()}.png`;
      a.click();
    }

    function drawCard(d) {
      const W = canvas.width, H = canvas.height;
      ctx.clearRect(0,0,W,H);

      if (fondoInput && fondoInput.files && fondoInput.files[0]) {
        const img = new Image();
        img.onload = () => {
          ctx.drawImage(img, 0, 0, W, H);
          drawOverlay(d);
        };
        img.src = URL.createObjectURL(fondoInput.files[0]);
      } else {
        const g = ctx.createLinearGradient(0,0,0,H);
        g.addColorStop(0, "#062036");
        g.addColorStop(1, "#103251");
        ctx.fillStyle = g;
        ctx.fillRect(0,0,W,H);
        drawOverlay(d);
      }
    }

    function drawOverlay(d) {
      const pad = 40;
      ctx.fillStyle = "rgba(0,0,0,0.5)";
      ctx.fillRect(pad, pad, canvas.width - pad*2, canvas.height - pad*2);

      ctx.fillStyle = "#fff";

      ctx.font = fontTitle;
      ctx.fillText((d.indicativo || "—").toUpperCase(), pad+30, pad+80);

      ctx.font = fontLabel;
      ctx.fillText("Fecha: " + (d.fecha || "—"), pad+30, pad+150);
      ctx.fillText("Hora (UTC): " + (d.hora || "—"), pad+30, pad+190);
      ctx.fillText("Frecuencia: " + (d.frecuencia || "—"), pad+30, pad+230);
      ctx.fillText("Modo: " + (d.modo || "—"), pad+30, pad+270);
      ctx.fillText("RST: " + (d.rst || "—"), pad+30, pad+310);
      ctx.fillText("QSL vía: " + (d.qsl || "—"), pad+30, pad+350);
      ctx.fillText("Operador: " + (d.nombre || "—"), pad+30, pad+390);
      ctx.fillText("QTH: " + (d.ubicacion || "—"), pad+30, pad+430);
      ctx.fillText("País: " + (d.pais || "—"), pad+30, pad+470);

      ctx.font = fontText;
      ctx.fillText("Notas: " + (d.notas || "—"), pad+30, pad+520);
    }

    // Mostrar mensaje de QSL no encontrada durante 10 segundos y luego volver al inicio
    function mostrarQslNoEncontrada() {
      if (!noQslMessage) return;
      noQslMessage.style.display = "block";

      setTimeout(() => {
        noQslMessage.style.display = "none";
        // Regresar a inicio: recargar la página
        window.location.reload();
      }, 10000); // 10 segundos
    }
  </script>
</body>
</html>
