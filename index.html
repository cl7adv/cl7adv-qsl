<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Navegador QSL Caribe√±o - CL7ADV</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Nunito:wght@300;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      /* Paleta inspirada en colores cubanos: azul, rojo, blanco y dorado c√°lido */
      --cuba-blue: #0b5bd7;
      --cuba-red: #d62828;
      --cuba-white: #ffffff;
      --cuba-gold: #d99a3b;
      --muted: #3f2b1f;
      --card-bg: rgba(255,255,255,0.95);
      --radius-lg: 16px;
      --shadow-1: 0 14px 40px rgba(40,20,10,0.12);
      --glass: rgba(255,255,255,0.6);
      --transition-fast: 160ms;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Nunito",system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
      color:var(--muted);
      background: linear-gradient(180deg,#fff8f2,#fff2e6);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.45;
      padding:18px;
    }

    /* HERO: fondo atardecer (aseg√∫rate de subir img/sunset-beach.jpg) */
    .hero {
      position: relative;
      min-height: 48vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 36px 18px;
      background-image: url('img/sunset-beach.jpg');
      background-size: cover;
      background-position: center center;
      border-radius: 18px;
      box-shadow: var(--shadow-1);
      overflow: hidden;
    }
    .hero::before{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(180deg, rgba(0,0,0,0.32), rgba(0,0,0,0.14) 40%, rgba(217,137,46,0.06) 100%);
      mix-blend-mode:multiply;
      pointer-events:none;
    }

    .hero-inner{
      position:relative; z-index:2; width:100%; max-width:1100px; display:flex; gap:20px; align-items:center; justify-content:space-between;
    }

    .brand {
      display:flex; gap:18px; align-items:center;
    }

    .logo {
      width:88px; height:88px; border-radius:14px;
      background: linear-gradient(180deg,#fff,#fff6ec);
      display:flex; align-items:center; justify-content:center;
      font-family:"Playfair Display",serif; font-weight:700; color:var(--cuba-blue);
      font-size:1.1rem; box-shadow: 0 10px 30px rgba(0,0,0,0.18); border:1px solid rgba(255,255,255,0.35);
    }

    .hero-title {
      color: var(--cuba-white);
      font-family:"Playfair Display",serif;
      font-size:2.4rem; margin:0; text-shadow: 0 8px 28px rgba(0,0,0,0.45);
    }
    .hero-sub { color: rgba(255,255,255,0.95); margin-top:8px; font-size:1rem; text-shadow: 0 6px 18px rgba(0,0,0,0.35); }

    /* Main container overlapping hero */
    .container {
      max-width:1100px; margin:-48px auto 28px; padding:24px;
      background: var(--card-bg); border-radius:var(--radius-lg); box-shadow: var(--shadow-1);
      border:1px solid rgba(180,120,60,0.06); position:relative; z-index:3;
    }

    .controls { display:flex; gap:12px; align-items:center; justify-content:center; flex-wrap:wrap; margin-bottom:14px; }
    #indicativo {
      padding:12px 14px; border-radius:12px; border:1px solid rgba(120,80,40,0.08);
      width:260px; font-size:1rem; background: linear-gradient(180deg,#fff,#fffaf3);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.6); color:var(--muted); outline:none;
      transition: box-shadow var(--transition-fast), transform var(--transition-fast);
    }
    #indicativo:focus { box-shadow: 0 8px 20px rgba(200,120,60,0.12); transform: translateY(-2px); }

    #buscarBtn {
      padding:12px 18px; border-radius:12px; border:none;
      background: linear-gradient(180deg,var(--cuba-blue), #0847b0);
      color:var(--cuba-white); font-weight:800; cursor:pointer;
      box-shadow: 0 10px 26px rgba(10,50,150,0.12); transition: transform var(--transition-fast);
    }
    #buscarBtn:hover { transform: translateY(-3px); }

    #resultado { margin-top:14px; min-height:40px; text-align:center; color:var(--muted); }
    .mensaje { font-size:1rem; color:var(--cuba-red); margin:8px 0; }

    /* Radio station card (Cuban style) */
    .radio-card {
      display:flex; gap:18px; align-items:center; justify-content:space-between;
      padding:14px; border-radius:12px; background: linear-gradient(180deg, rgba(11,91,215,0.04), rgba(214,90,90,0.02));
      border: 1px solid rgba(11,91,215,0.06); box-shadow: 0 8px 20px rgba(10,40,100,0.06);
      margin: 12px auto; max-width:880px;
    }

    .radio-info {
      display:flex; gap:12px; align-items:center;
    }

    .station-badge {
      width:84px; height:84px; border-radius:12px; display:flex; align-items:center; justify-content:center;
      background: linear-gradient(180deg,var(--cuba-red), #b21f1f); color:var(--cuba-white); font-weight:800; font-family:"Playfair Display",serif;
      box-shadow: 0 8px 20px rgba(180,40,40,0.12);
      border: 2px solid rgba(255,255,255,0.12);
    }

    .station-meta { display:flex; flex-direction:column; gap:4px; }
    .station-name { font-weight:800; font-size:1.05rem; color:var(--muted); }
    .station-freq { font-size:0.95rem; color:#6b4f3a; }

    /* Player controls */
    .player-controls { display:flex; gap:10px; align-items:center; }
    .btn-play {
      width:56px; height:56px; border-radius:12px; border:none; cursor:pointer;
      background: linear-gradient(180deg,var(--cuba-gold), #c07a2a); color:#fff; font-weight:800;
      box-shadow: 0 10px 26px rgba(200,120,40,0.12);
      display:flex; align-items:center; justify-content:center; font-size:1.1rem;
    }
    .btn-play.paused { background: linear-gradient(180deg,var(--cuba-blue), #0847b0); }

    .volume { width:120px; }
    .status { font-size:0.95rem; color:#5a3f2b; margin-left:8px; min-width:140px; }

    /* Wave visual (simple animated bars) */
    .wave {
      display:flex; gap:4px; align-items:end; height:36px; margin-left:12px;
    }
    .wave div {
      width:6px; background: linear-gradient(180deg,#ffd89a,#ffb74d); border-radius:3px;
      animation: wave 900ms linear infinite;
      opacity:0.95;
    }
    .wave div:nth-child(1){ animation-delay: 0ms; height:8px; }
    .wave div:nth-child(2){ animation-delay: 120ms; height:18px; }
    .wave div:nth-child(3){ animation-delay: 240ms; height:12px; }
    .wave div:nth-child(4){ animation-delay: 360ms; height:26px; }
    .wave div:nth-child(5){ animation-delay: 480ms; height:10px; }
    @keyframes wave {
      0% { transform: scaleY(0.4); }
      50% { transform: scaleY(1.0); }
      100% { transform: scaleY(0.4); }
    }

    /* QSL list and modal */
    #listaQSLs { display:flex; flex-wrap:wrap; gap:18px; justify-content:center; margin-top:12px; }
    .qsl-img { max-width:240px; border-radius:12px; border: 3px solid rgba(200,140,80,0.12); box-shadow: 0 12px 30px rgba(120,70,30,0.08); background: linear-gradient(180deg,#fff,#fff8f2); transition: transform .22s ease; }
    .qsl-img:hover { transform: translateY(-6px); }

    .modal { display:none; position:fixed; inset:0; z-index:1200; background: rgba(20,12,8,0.45); align-items:center; justify-content:center; padding:20px; }
    .modal-contenido { width:100%; max-width:920px; background: linear-gradient(180deg,#fffaf0,#fff7ef); border-radius:14px; padding:18px; box-shadow: 0 20px 50px rgba(60,30,10,0.25); color:#3f2b1f; }
    .cerrar { float:right; font-size:26px; cursor:pointer; color:#7a5a44; }

    @media (max-width:720px){
      .hero-inner{ flex-direction:column; gap:12px; text-align:center; }
      .hero-title{ font-size:1.6rem; }
      .container{ margin-top:-28px; padding:18px; }
      .progress-bar{ width:260px; }
      #indicativo{ width:160px; }
      .radio-card{ flex-direction:column; align-items:center; text-align:center; gap:12px; }
      .player-controls{ justify-content:center; }
    }
  </style>
</head>
<body>
  <!-- Hero -->
  <section class="hero" role="banner" aria-label="Portada atardecer en la playa">
    <div class="hero-inner">
      <div class="brand" aria-hidden="true">
        <div class="logo">CL7</div>
      </div>

      <div style="flex:1; max-width:720px; text-align:center;">
        <h1 class="hero-title">Navegador QSL Caribe√±o</h1>
        <p class="hero-sub">Busca y descarga tus QSL con estilo ‚Äî buenos DXs desde la costa</p>
      </div>
    </div>
  </section>

  <!-- Main -->
  <main class="container" role="main">
    <div class="controls" aria-label="Controles de b√∫squeda">
      <input id="indicativo" type="text" placeholder="Ej: CL7ADV" aria-label="Indicativo">
      <button id="buscarBtn" type="button">Buscar QSL</button>
    </div>

    <!-- Radio station card (Cuban colors) -->
    <section class="radio-card" aria-label="Estaci√≥n de radio">
      <div class="radio-info">
        <div class="station-badge" aria-hidden="true">RAD</div>
        <div class="station-meta">
          <div class="station-name">Estaci√≥n QSL Caribe√±a</div>
          <div class="station-freq">FM 88.7 ¬∑ Streaming ¬∑ Santa Cruz del Sur</div>
          <div style="font-size:0.9rem; color:#6b4f3a;">Programaci√≥n: m√∫sica, DX, reportes y QSLs</div>
        </div>
      </div>

      <div class="player-controls" aria-hidden="false">
        <button id="playBtn" class="btn-play" aria-pressed="false" title="Reproducir / Pausar">‚ñ∂</button>
        <input id="volume" class="volume" type="range" min="0" max="1" step="0.01" value="0.8" aria-label="Volumen">
        <div class="wave" aria-hidden="true">
          <div></div><div></div><div></div><div></div><div></div>
        </div>
        <div id="radioStatus" class="status">Detenida</div>
      </div>
    </section>

    <!-- Loader (kept from previous design) -->
    <div id="loaderContainer" class="loader-wrap" aria-hidden="true" style="display:none;">
      <div class="spinner" id="spinner" role="status" aria-hidden="true"></div>
      <div>
        <div class="progress-bar" id="progressBar">
          <div id="progressFill" class="progress-fill" style="width:0%"></div>
          <div id="cardThumb" class="card-thumb" style="left:0%"><img id="cardThumbImg" src="img/mini-qsl.jpg" alt="mini QSL" onerror="this.style.display='none'; this.parentElement.textContent='QSL'"></div>
        </div>
        <div id="progressText" class="progress-text">Iniciando b√∫squeda...</div>
      </div>
    </div>

    <div id="resultado" role="status" aria-live="polite"></div>

    <footer>
      ‚Äî CL7ADV ‚Äî Buenos DXs en este 2026 ¬∑ Radio Club Santa Cruz Del Sur/Alfred
    </footer>
  </main>

  <!-- Modal QSLs -->
  <div id="ventanaQSL" class="modal" aria-hidden="true">
    <div class="modal-contenido" role="dialog" aria-modal="true" aria-labelledby="qslTitle">
      <span class="cerrar" id="cerrarBtn" title="Cerrar">&times;</span>
      <h2 id="qslTitle">QSLs disponibles</h2>
      <div id="contador"></div>
      <div id="listaQSLs"></div>
      <br>
      <button class="descargar" id="descargarTodasBtn" type="button">‚¨áÔ∏è Descargar todas</button>
    </div>
  </div>

  <script>
    // Variables QSL
    let totalQSLs = 0, descargadas = 0, listaActual = [], imagenCargada = false, timeoutId = null;

    // Radio player (simulado)
    const playBtn = document.getElementById('playBtn');
    const volume = document.getElementById('volume');
    const radioStatus = document.getElementById('radioStatus');
    const wave = document.querySelectorAll('.wave div');

    let isPlaying = false;
    let waveInterval = null;

    function setWaveActive(active) {
      if (!wave) return;
      if (active) {
        wave.forEach((bar, i) => {
          bar.style.animationPlayState = 'running';
        });
      } else {
        wave.forEach(bar => {
          bar.style.animationPlayState = 'paused';
        });
      }
    }

    function startWaveSimulation() {
      setWaveActive(true);
      if (waveInterval) clearInterval(waveInterval);
      waveInterval = setInterval(() => {
        wave.forEach(bar => {
          const h = 8 + Math.round(Math.random() * 28);
          bar.style.height = h + 'px';
        });
      }, 220);
    }

    function stopWaveSimulation() {
      setWaveActive(false);
      if (waveInterval) { clearInterval(waveInterval); waveInterval = null; }
      wave.forEach((bar, i) => {
        bar.style.height = (8 + i*4) + 'px';
      });
    }

    playBtn.addEventListener('click', () => {
      isPlaying = !isPlaying;
      playBtn.classList.toggle('paused', !isPlaying);
      playBtn.textContent = isPlaying ? '‚è∏' : '‚ñ∂';
      playBtn.setAttribute('aria-pressed', String(isPlaying));
      radioStatus.textContent = isPlaying ? 'Reproduciendo ¬∑ Estaci√≥n QSL Caribe√±a' : 'Detenida';
      if (isPlaying) startWaveSimulation(); else stopWaveSimulation();
    });

    volume.addEventListener('input', (e) => {
      // Simulaci√≥n: ajustar intensidad de la onda seg√∫n volumen
      const v = parseFloat(e.target.value);
      wave.forEach((bar, i) => {
        const base = 8 + i*4;
        bar.style.height = Math.round(base * (0.4 + v*1.2)) + 'px';
      });
    });

    // QSL search logic (same behavior as before)
    window.onerror = function(message, source, lineno, colno, error) {
      console.error('ERROR GLOBAL:', message, 'at', source + ':' + lineno + ':' + colno);
      const resultado = document.getElementById('resultado');
      if (resultado) resultado.innerHTML = `<p class="mensaje">‚ö†Ô∏è Error: ${message} (ver consola)</p>`;
      return false;
    };

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('buscarBtn').addEventListener('click', buscarQSL);
      document.getElementById('cerrarBtn').addEventListener('click', cerrarVentana);
      document.getElementById('descargarTodasBtn').addEventListener('click', descargarTodas);
      document.getElementById('ventanaQSL').addEventListener('click', (e) => {
        if (e.target === document.getElementById('ventanaQSL')) cerrarVentana();
      });
      // Initialize wave paused
      stopWaveSimulation();
    });

    function animateCardTo(cardElem, targetPct, duration = 100) {
      if (!cardElem) return;
      if (cardElem._animFrame) cancelAnimationFrame(cardElem._animFrame);
      const start = parseFloat(cardElem.style.left) || 0;
      const end = Math.max(0, Math.min(100, targetPct));
      const startTime = performance.now();
      function ease(t){ return t<0.5 ? 2*t*t : -1 + (4 - 2*t)*t; }
      function step(now){
        const t = Math.min(1, (now - startTime) / duration);
        const eased = ease(t);
        const current = start + (end - start) * eased;
        cardElem.style.left = current + '%';
        if (t < 1) cardElem._animFrame = requestAnimationFrame(step);
        else cardElem._animFrame = null;
      }
      cardElem._animFrame = requestAnimationFrame(step);
    }

    function buscarQSL(){
      imagenCargada = false;
      if (timeoutId){ clearTimeout(timeoutId); timeoutId = null; }

      const indicativo = document.getElementById("indicativo").value.trim().toUpperCase();
      const resultado = document.getElementById("resultado");
      const listaQSLs = document.getElementById("listaQSLs");
      resultado.innerHTML = ""; if (listaQSLs) listaQSLs.innerHTML = "";

      if (!indicativo){
        resultado.innerHTML = `<p class="mensaje">üå∫ Por favor escribe un indicativo</p>`;
        setTimeout(()=>{ resultado.innerHTML = ""; }, 4500);
        return;
      }

      const loader = document.getElementById('loaderContainer');
      const progressFill = document.getElementById('progressFill');
      const progressText = document.getElementById('progressText');
      const cardThumb = document.getElementById('cardThumb');
      if (loader) { loader.style.display = 'flex'; loader.setAttribute('aria-hidden','false'); }
      if (progressFill) progressFill.style.width = '0%';
      if (cardThumb) cardThumb.style.left = '0%';
      if (progressText) progressText.textContent = 'üîÑ Buscando QSL‚Ä¶';

      let posibles = []; posibles.push(`img/${indicativo}.jpg`);
      for (let i=1;i<=50;i++) posibles.push(`img/${indicativo}-${i}.jpg`);

      let encontradas = [], comprobadas = 0, totalPosibles = posibles.length;
      if (timeoutId) clearTimeout(timeoutId);

      function actualizarProgreso(){
        const pct = Math.round((comprobadas / totalPosibles) * 100);
        if (progressFill) progressFill.style.width = pct + '%';
        const offset = 12;
        const cardPos = Math.min(100, pct + offset);
        if (cardThumb) animateCardTo(cardThumb, cardPos, 90);
        if (progressText) progressText.textContent = `Comprobadas ${comprobadas} / ${totalPosibles} (${pct}%)`;
      }

      posibles.forEach(ruta=>{
        const img = new Image();
        img.onload = ()=>{
          comprobadas++; actualizarProgreso();
          if (!encontradas.includes(ruta)){
            imagenCargada = true; encontradas.push(ruta);
            mostrarQSLs(encontradas, indicativo);
            if (progressFill) progressFill.style.width = '100%';
            if (cardThumb) animateCardTo(cardThumb, 100, 90);
            if (progressText) progressText.textContent = `Se encontraron ${encontradas.length} QSL`;
            setTimeout(()=>{ if (loader) { loader.style.display='none'; loader.setAttribute('aria-hidden','true'); } }, 700);
          }
        };
        img.onerror = ()=>{
          comprobadas++; actualizarProgreso();
          if (comprobadas >= totalPosibles && !imagenCargada){
            setTimeout(()=>{ if (loader) { loader.style.display='none'; loader.setAttribute('aria-hidden','true'); } }, 300);
          }
        };
        img.src = ruta;
      });

      timeoutId = setTimeout(()=>{
        if (!imagenCargada){
          resultado.innerHTML = `<p class="mensaje">‚ùå No tenemos esa QSL, pero pronto estar√° lista üå∫</p>`;
          if (progressText) progressText.textContent = 'B√∫squeda finalizada: no se encontraron im√°genes';
          setTimeout(()=>{ if (loader) { loader.style.display='none'; loader.setAttribute('aria-hidden','true'); } }, 900);
        }
      }, 10000);
    }

    function mostrarQSLs(lista, indicativo){
      const ventana = document.getElementById("ventanaQSL");
      const listaQSLs = document.getElementById("listaQSLs");
      if (!lista || lista.length===0) return;
      if (listaQSLs) listaQSLs.innerHTML = `<p class="mensaje">üì° Se encontraron ${lista.length} QSL para <strong>${indicativo}</strong></p>`;
      totalQSLs = lista.length; descargadas = 0; listaActual = lista.slice();
      actualizarContador();
      lista.forEach(ruta=>{
        if (listaQSLs) listaQSLs.innerHTML += `
          <div>
            <img src="${ruta}" alt="QSL de ${indicativo}" class="qsl-img">
            <br>
            <a href="${ruta}" download class="descargar" onclick="marcarDescarga()">‚¨áÔ∏è Descargar QSL</a>
          </div>
        `;
      });
      if (ventana) { ventana.style.display = "flex"; ventana.setAttribute('aria-hidden','false'); }
    }

    function actualizarContador(){
      const contador = document.getElementById("contador");
      if (contador) contador.innerHTML = `<p class="mensaje">Has descargado ${descargadas} de ${totalQSLs} QSL</p>`;
    }

    function marcarDescarga(){
      descargadas++; actualizarContador();
      if (descargadas >= totalQSLs){
        const listaQSLs = document.getElementById("listaQSLs");
        if (listaQSLs) listaQSLs.innerHTML = `<p class="mensaje">‚úÖ Has descargado todas tus QSL, buenos DXs üå∫</p>`;
        setTimeout(()=>{ cerrarVentana(); document.getElementById("resultado").innerHTML=""; document.getElementById("indicativo").value=""; }, 1600);
      }
    }

    function descargarTodas(){
      if (!listaActual || listaActual.length===0) return;
      listaActual.forEach(ruta=>{
        const link = document.createElement("a");
        link.href = ruta; link.download = ruta.split("/").pop();
        document.body.appendChild(link); link.click(); document.body.removeChild(link);
        descargadas++;
      });
      actualizarContador();
      if (descargadas >= totalQSLs){
        const listaQSLs = document.getElementById("listaQSLs");
        if (listaQSLs) listaQSLs.innerHTML = `<p class="mensaje">‚úÖ Has descargado todas tus QSL, buenos DXs üå∫</p>`;
        setTimeout(()=>{ cerrarVentana(); document.getElementById("resultado").innerHTML=""; document.getElementById("indicativo").value=""; }, 1600);
      }
    }

    function cerrarVentana(){
      const ventana = document.getElementById("ventanaQSL");
      if (ventana) { ventana.style.display = "none"; ventana.setAttribute('aria-hidden','true'); }
    }
  </script>
</body>
</html>
