<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>QSL Caribe√±a v34.0 - FILE MANAGER</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
    <style>
        :root {
            --n-blue: #00eaff;
            --n-pink: #ff00ff;
            --bg: #010409;
        }

        body { 
            margin: 0; background: var(--bg); color: white; 
            font-family: 'Segoe UI', sans-serif;
            background-image: radial-gradient(circle at 50% 50%, #0a1120 0%, #010409 100%);
        }

        /* --- NAVEGACI√ìN --- */
        .top-nav {
            background: #000; border-bottom: 2px solid var(--n-blue);
            display: flex; justify-content: space-between; align-items: center; padding: 15px 25px;
            position: sticky; top: 0; z-index: 1000;
        }

        .tab-box { display: flex; justify-content: center; gap: 5px; margin: 20px 0; }
        .tab-btn {
            padding: 12px 20px; border: none; background: #111; color: #666;
            cursor: pointer; border-radius: 8px; font-weight: 900;
        }
        .tab-btn.active { background: var(--n-blue); color: #000; }

        /* --- CARPETAS --- */
        .folder-bar {
            display: flex; gap: 10px; overflow-x: auto; padding: 10px;
            background: rgba(255,255,255,0.03); border-radius: 10px; margin-bottom: 20px;
        }
        .folder {
            padding: 10px 20px; background: #222; border-radius: 5px;
            cursor: pointer; white-space: nowrap; border: 1px solid #333;
        }
        .folder.active { border-color: var(--n-pink); color: var(--n-pink); }

        /* --- PANEL ADMIN --- */
        #admin-controls {
            display: none; background: #111; border: 1px solid var(--n-pink);
            padding: 20px; border-radius: 15px; margin-bottom: 20px; text-align: left;
        }

        /* --- GRILLA --- */
        .grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px; margin-top: 20px;
        }
        .card {
            aspect-ratio: 3/2; background: #000; border: 2px solid #222;
            border-radius: 12px; position: relative; overflow: hidden; cursor: pointer;
        }
        .card.selected { border-color: var(--n-blue); box-shadow: 0 0 15px var(--n-blue); }
        .card img { width: 100%; height: 100%; object-fit: cover; }
        
        .card-tools {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); display: none; flex-direction: column;
            justify-content: center; align-items: center; gap: 5px;
        }
        .card:hover .card-tools { display: flex; }

        /* --- ESTILOS GENERALES --- */
        .page { display: none; width: 95%; max-width: 900px; margin: 0 auto; text-align: center; }
        .page.active { display: block; }
        input[type="text"] {
            width: 80%; padding: 15px; background: #000; border: 2px solid var(--n-blue);
            border-radius: 10px; color: white; font-size: 1.5rem; text-align: center; font-weight: 900;
        }
        .btn-action {
            padding: 15px 30px; border-radius: 30px; border: none; font-weight: 900;
            cursor: pointer; margin-top: 20px; text-transform: uppercase;
        }

        /* --- MODAL --- */
        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:9000; }
        canvas { max-width: 90%; display: block; margin: 40px auto; border: 2px solid var(--n-blue); }
    </style>
</head>
<body onload="init()">

    <div class="top-nav">
        <div id="clock" style="color: var(--n-blue); font-family: monospace; font-weight: bold;">00:00:00 UTC</div>
        <button onclick="authAdmin()" style="background:none; border: 1px solid #333; color: #444; cursor:pointer;">MODERAR</button>
    </div>

    <div class="tab-box">
        <button class="tab-btn active" onclick="switchTab('search')">üîç BUSCAR</button>
        <button class="tab-btn" onclick="switchTab('act')">üì° ACTIVIDADES</button>
    </div>

    <div id="p-search" class="page active">
        <h2 style="color: var(--n-blue);">CENTRO DE DESCARGAS</h2>
        <input type="text" id="s-call" placeholder="TU INDICATIVO">
        <br>
        <button class="btn-action" style="background: var(--n-blue);" onclick="doSearch()">ESCANEAR</button>
        <div id="results" style="margin-top: 30px;"></div>
    </div>

    <div id="p-act" class="page">
        <div id="admin-controls">
            <h4 style="margin:0; color: var(--n-pink);">PANEL DE CARPETAS</h4>
            <input type="text" id="new-folder-name" placeholder="Nombre Carpeta" style="font-size: 1rem; width: 150px; padding: 5px;">
            <button onclick="addFolder()" style="padding: 5px 10px;">CREAR CARPETA</button>
            <hr style="border: 0.5px solid #222; margin: 15px 0;">
            <p style="font-size: 0.7rem;">Mover seleccionadas a: 
                <select id="move-target"></select> 
                <button onclick="moveImages()">MOVER</button>
            </p>
        </div>

        <div class="folder-bar" id="folderBar"></div>

        <input type="text" id="g-call" placeholder="INDICATIVO">
        <br>
        <button class="btn-action" style="background: var(--n-pink); color: white;" onclick="generate()">GENERAR TARJETA</button>

        <div class="grid" id="mainGrid"></div>

        <div style="margin-top: 30px; border: 2px dashed #333; padding: 20px; border-radius: 15px;">
            <p style="font-size: 0.7rem; color: #888;">SUBIR A CARPETA ACTUAL:</p>
            <input type="file" id="fileIn" multiple accept="image/*">
        </div>
    </div>

    <div id="modal" class="modal">
        <canvas id="cvs"></canvas>
        <div style="text-align: center;">
            <button class="btn-action" style="background:red; color:white;" onclick="download()">GUARDAR</button>
            <button class="btn-action" style="background:#333; color:white; margin-left:10px;" onclick="closeM()">CERRAR</button>
        </div>
    </div>

    <script>
        let folders = JSON.parse(localStorage.getItem('zmr_folders')) || { "General": [] };
        let currentFolder = "General";
        let isAdmin = false;
        let selectedIdx = -1;

        function init() {
            renderFolders();
            renderGrid();
            setInterval(() => {
                document.getElementById('clock').innerText = new Date().toUTCString().split(' ')[4];
            }, 1000);
        }

        function authAdmin() {
            if(prompt("CLAVE:") === "Leila2026") {
                isAdmin = !isAdmin;
                document.getElementById('admin-controls').style.display = isAdmin ? 'block' : 'none';
                renderGrid();
                renderFolders();
            }
        }

        function renderFolders() {
            const bar = document.getElementById('folderBar');
            const select = document.getElementById('move-target');
            bar.innerHTML = "";
            select.innerHTML = "";
            
            Object.keys(folders).forEach(f => {
                const div = document.createElement('div');
                div.className = `folder ${currentFolder === f ? 'active' : ''}`;
                div.innerHTML = `üìÅ ${f} ${isAdmin && f !== 'General' ? `<span onclick="delFolder('${f}')" style="color:red; margin-left:10px;">√ó</span>` : ''}`;
                div.onclick = (e) => { if(e.target.tagName !== 'SPAN') { currentFolder = f; renderFolders(); renderGrid(); } };
                bar.appendChild(div);

                select.innerHTML += `<option value="${f}">${f}</option>`;
            });
        }

        function addFolder() {
            const name = document.getElementById('new-folder-name').value.trim();
            if(name && !folders[name]) {
                folders[name] = [];
                save();
                renderFolders();
            }
        }

        function delFolder(f) {
            if(confirm("¬øBorrar carpeta y mover fotos a General?")) {
                folders["General"] = folders["General"].concat(folders[f]);
                delete folders[f];
                currentFolder = "General";
                save(); renderFolders(); renderGrid();
            }
        }

        function renderGrid() {
            const grid = document.getElementById('mainGrid');
            grid.innerHTML = "";
            const currentData = folders[currentFolder] || [];

            currentData.forEach((img, i) => {
                const div = document.createElement('div');
                div.className = `card ${selectedIdx === i ? 'selected' : ''}`;
                div.innerHTML = `<img src="${img}">`;
                
                if(isAdmin) {
                    const tools = document.createElement('div');
                    tools.className = "card-tools";
                    tools.innerHTML = `<button onclick="deleteImg(${i})" style="background:red; color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer;">BORRAR</button>`;
                    div.appendChild(tools);
                }

                div.onclick = (e) => { if(e.target.tagName !== 'BUTTON') { selectedIdx = i; renderGrid(); } };
                grid.appendChild(div);
            });
        }

        document.getElementById('fileIn').onchange = function(e) {
            Array.from(e.target.files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function() {
                    folders[currentFolder].push(reader.result);
                    save();
                    renderGrid();
                };
                reader.readAsDataURL(file);
            });
        };

        function deleteImg(i) {
            folders[currentFolder].splice(i, 1);
            save(); renderGrid();
        }

        function save() { localStorage.setItem('zmr_folders', JSON.stringify(folders)); }

        function switchTab(t) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('p-'+t).classList.add('active');
            event.target.classList.add('active');
        }

        // GENERADOR
        function generate() {
            const call = document.getElementById('g-call').value.trim().toUpperCase();
            if(!call || selectedIdx === -1) return alert("Elige una tarjeta e indicativo");
            const canvas = document.getElementById('cvs');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            img.onload = () => {
                canvas.width = img.width; canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                ctx.fillStyle = "white"; ctx.strokeStyle = "black";
                ctx.lineWidth = canvas.width * 0.01; ctx.font = `italic 900 ${canvas.width * 0.08}px Arial`;
                ctx.textAlign = "center";
                ctx.strokeText(call, canvas.width / 2, canvas.height * 0.85);
                ctx.fillText(call, canvas.width / 2, canvas.height * 0.85);
                document.getElementById('modal').style.display = 'block';
            };
            img.src = folders[currentFolder][selectedIdx];
        }

        function closeM() { document.getElementById('modal').style.display = 'none'; }
        function download() {
            const a = document.createElement('a');
            a.download = "QSL_CARIBE.png";
            a.href = document.getElementById('cvs').toDataURL();
            a.click();
        }
    </script>
</body>
</html>
